<link rel="stylesheet" href="/css/test-forms.css">
<link rel="stylesheet" href="/css/question.css">
<div class="aptitude-container">
    <!-- <div class="test-progress" style="opacity: 0;">
        <div class="progress-stats">
            <div class="progress-count">
                <span class="current"><%= currentQuestionIndex + 1 %></span>
                <span class="total">/ <%= totalQuestions %></span>
            </div>
            <div class="progress-label">Questions Completed</div>
        </div>
        <div class="progress-bar-container">
            <div class="progress-bar-outer">
                <div class="progress-bar-inner" style="width: <%= ((currentQuestionIndex + 1) / totalQuestions) * 100 %>%"></div>
            </div>
            <div class="progress-markers">
                <% for(let i = 0; i < totalQuestions; i++) { %>
                    <div class="marker <%= i <= currentQuestionIndex ? 'active' : '' %>"></div>
                <% } %>
            </div>
        </div>
    </div> -->

    <div class="question-card <%= question.is_completed ? 'completed' : '' %>">
        <div class="question-header">
            <div class="progress-info">
                <span class="question-count">Question <%= currentQuestionIndex + 1 %> of <%= totalQuestions %></span>
                <div class="progress-bar">
                    <div class="progress" style="width: <%= ((currentQuestionIndex + 1) / totalQuestions) * 100 %>%"></div>
                </div>
            </div>
        </div>

        <div class="question-content">
            <h2 class="question-text">
                <%= question.q_id.question %><br>
                <% if(question.q_id.question_image){ %>
                    <img src="<%= question.q_id.question_image %>" width="100px" height="100px" alt="">
                <% } %>
            </h2>

            <form action="/aptitude/test/answer/<%= testId %>" method="POST" class="options-form">
                <div class="options-grid">
                    <% if(question.q_id.question_image){ %>
                        <% question.q_id.options.forEach((option, optIndex) => { %>
                            <div class="option-item">
                                <input class="option-input" 
                                       type="radio" 
                                       name="answer" 
                                       id="option<%= optIndex %>" 
                                       value="<%= option %>"
                                       <%= question.selected_answer === option ? 'checked' : '' %>>
                                <label class="option-label <%= question.selected_answer === option ? 'active previously-selected' : '' %>" 
                                       for="option<%= optIndex %>">
                                    <img src="<%= option.charAt(0).toUpperCase() + option.slice(1) %>" width="100px" height="100px" alt="">
                                    <% if (question.selected_answer === option) { %>
                                        <span class="selection-indicator">Your Previous Answer</span>
                                    <% } %>
                                </label>
                            </div>
                          <% }); %>
                    <% } else { %>
                      <% question.q_id.options.forEach((option, optIndex) => { %>
                        <div class="option-item">
                            <input class="option-input" 
                                   type="radio" 
                                   name="answer" 
                                   id="option<%= optIndex %>" 
                                   value="<%= option %>"
                                   <%= question.selected_answer === option ? 'checked' : '' %>>
                            <label class="option-label <%= question.selected_answer === option ? 'active previously-selected' : '' %>" 
                                   for="option<%= optIndex %>">
                                <span class="option-text">
                                    <%= option.charAt(0).toUpperCase() + option.slice(1) %>
                                </span>
                                <% if (question.selected_answer === option) { %>
                                    <span class="selection-indicator">Your Previous Answer</span>
                                <% } %>
                            </label>
                        </div>
                      <% }); %>
                    <% }%>
                </div>

                <input type="hidden" name="questionId" value="<%= question._id %>">
                <input type="hidden" name="currentQuestionIndex" value="<%= currentQuestionIndex %>">

                <div class="navigation-buttons">
                    <% if (currentQuestionIndex> 0) { %>
                        <a href="/aptitude/test/pending/<%= testId %>?q=<%= currentQuestionIndex - 1 %>"
                            class="nav-button back-button">Previous Question</a>
                        <% } %>

                            <button type="submit" class="nav-button next-button">
                                <%= currentQuestionIndex < totalQuestions - 1 ? 'Next Question' : 'Submit Test' %>
                            </button>
                </div>
            </form>
        </div>
    </div>
</div>